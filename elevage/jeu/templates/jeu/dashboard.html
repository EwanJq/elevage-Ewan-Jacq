<!DOCTYPE html>
{% load static %}
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{{ rearing.rearing_name }} - Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .action-form {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            background-size: cover;
            background-position: center;
            color: white; /* Pour garantir que le texte reste lisible */
            backdrop-filter: blur(5px); /* Optionnel pour flouter l'arrière-plan */
        }
        .form-group { margin-bottom: 10px; }
        .btn { 
            padding: 10px 15px;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .btn-buy {
            background-color: rgba(255, 255, 255, 0.7); /* Pour rendre les boutons plus visibles */
        }
        .btn-sell {
            background-color: rgba(255, 255, 255, 0.7);
        }
        .btn-next-turn {
            background-color: rgba(255, 255, 255, 0.7);
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .resources {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
            background-color: rgba(240, 240, 240, 0.8);
            padding: 15px;
            border-radius: 8px;
        }
        .cages-container {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding-bottom: 10px;
        }
        .cage-card {
            flex: 0 0 auto;
            min-width: 150px;
            background-color: rgba(255, 255, 255, 0.8);
            background-image: url('{% static "jeu/images/textures/cage_texture.png" %}');
            background-size: cover;
            border-left: 5px solid #2196F3;
            padding: 10px;
            border-radius: 6px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        .cage-card h3 {
            background-color: rgba(255, 255, 255, 0.7);
            padding: 5px;
            border-radius: 4px;
        }
        .cage-lapins {
            display: none;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ccc;
        }
        .lapin {
            margin-bottom: 5px;
        }
        .lapin:hover {
            text-decoration: underline;
        }
    </style>
    <script>
        function toggleLapins(cageId) {
            const lapinsDiv = document.getElementById('lapins-' + cageId);
            lapinsDiv.style.display = (lapinsDiv.style.display === "none") ? "block" : "none";
        }
    </script>
</head>

<body style="background-image: url('{% static background_image %}'); background-size: cover; background-repeat: no-repeat; background-attachment: fixed;">

    <!-- Affichage des ressources -->
    <div class="resources">
        <div><strong>Argent:</strong> {{ rearing.current_money }} €</div>
        <div><strong>Nourriture:</strong> {{ rearing.current_food }} kg</div>
        <div><strong>Total de lapins:</strong> {{ rearing.total_rabbits }}</div>
        <div><strong>Nombre de cages:</strong> {{ rearing.total_cages }}</div>
    </div>

    <!-- Formulaires d'achat et de vente côte à côte -->
    <div style="display: flex; gap: 20px;">
        <!-- Formulaire d'achat -->
        <form method="post" class="action-form" style="flex: 1; background-image: url('{% static "jeu/images/bois1.jpg" %}');">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="buy">
            <h2>Achat d'objets</h2>

            <div class="form-group">
                {{ buy_form.item_type.label_tag }}<br>
                {{ buy_form.item_type }}
            </div>
            <div class="form-group">
                {{ buy_form.quantity.label_tag }}<br>
                {{ buy_form.quantity }}
            </div>
            <button type="submit" class="btn btn-buy">Acheter</button>
        </form>

        <!-- Formulaire de vente -->
        <form method="post" class="action-form" style="flex: 1; background-image: url('{% static "jeu/images/bois2.jpg" %}');">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="sell">
            <h2>Vente d'objets</h2>

            <div class="form-group">
                {{ sell_form.item_type.label_tag }}<br>
                {{ sell_form.item_type }}
            </div>
            <div class="form-group">
                {{ sell_form.quantity.label_tag }}<br>
                {{ sell_form.quantity }}
            </div>
            <button type="submit" class="btn btn-sell">Vendre</button>
        </form>
    </div>

    <!-- Passage au mois suivant -->
    <form method="post" action="{% url 'jeu:rearing_dashboard' rearing_name=rearing.rearing_name %}" class="action-form" style="background-image: url('{% static "jeu/images/bois3.jpg" %}');">
        {% csrf_token %}
        <input type="hidden" name="form_type" value="next_turn">
        <h2>Actions pour le prochain mois</h2>
        <button type="submit" class="btn btn-next-turn">Passer au mois suivant</button>
    </form>

    <!-- Cages -->
    <h2>Cages</h2>
    <div class="cages-container">
        {% for cage in rearing.cages.all %}
            <div class="cage-card">
                <h3>Cage #{{ forloop.counter }}</h3>
                <button type="button" onclick="toggleLapins({{ forloop.counter }})" class="btn" style="margin-top: 10px;">Voir les lapins</button>
                <div class="cage-lapins" id="lapins-{{ forloop.counter }}">
                    {% with rabbits=cage.rabbit_set.all %}
                        {% if rabbits %}
                            <ul>
                                {% for rabbit in rabbits %}
                                    <li class="lapin" title="Faim: {{ rabbit.hunger }}%, Infection: {{ rabbit.infection }}%">
                                        {{ rabbit.type }} - {{ rabbit.age }} mois
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p>Aucun lapin.</p>
                        {% endif %}
                    {% endwith %}
                </div>
            </div>
        {% empty %}
            <p>Aucune cage disponible.</p>
        {% endfor %}
    </div>

</body>
</html>
